---
import Layout from '../../layouts/Layout.astro';
import CodeRunner from '../../components/CodeRunner.astro';

const examples = [
	{
		title: 'Syntax & Types',
		description:
			'Primitives, string interpolation, arrays, maps, and arithmetic with operator precedence.',
		code: `# Primitives and string interpolation
(var name "Gene")
(var year 2026)
(println "Hello from #{name} (#{year})!")

# Arithmetic with operator precedence
(println (5 + 3 * 2))        # => 11
(println (2 ** 10))           # => 1024
(println (10 % 3))            # => 1

# Arrays and maps
(var arr [1 2 3 4 5])
(var m {^lang "Gene" ^year 2026})
(println arr/2 m/lang)        # => 3 Gene
(println arr/.length)         # => 5

# Nil-safe property access
(var obj nil)
(println obj/x)               # => nil (no crash)`,
	},
	{
		title: 'Homoiconic Design',
		description:
			'Code and data share the same structure. Quote with ` to treat any expression as data.',
		code: `# Quote with \` preserves structure as data
(var expr \`(if (x > 0) "positive" else "negative"))
(println expr)

# Symbols are first-class values
(var sym \`success)
(println (sym == \`success))   # => true

# The Gene data structure: (Type ^prop val child...)
(var user \`(User ^name "Alice" ^age 30 "admin"))
(println user)

# Everything follows the same pattern:
# data, code, configs, function calls — all one structure`,
	},
	{
		title: 'Functions & Closures',
		description:
			'Named functions, anonymous lambdas, closures, and higher-order collection methods.',
		code: `# Named function
(fn add [a b] (a + b))
(println (add 3 4))          # => 7

# Default parameters
(fn greet [name = "World"]
  (println "Hello, #{name}!"))
(greet)                      # => Hello, World!
(greet "Alice")              # => Hello, Alice!

# Closures capture their environment
(fn make_adder [x]
  (fn [y] (x + y)))
(var add10 (make_adder 10))
(println (add10 5))          # => 15

# Higher-order collection methods
(var nums [1 2 3 4 5])
(println (nums .map (fn [x] (x * 2))))          # => [2 4 6 8 10]
(println (nums .filter (fn [x] (x > 3))))       # => [4 5]
(println (nums .reduce 0 (fn [acc x] (acc + x))))  # => 15`,
	},
	{
		title: 'Classes & Inheritance',
		description:
			'Object-oriented programming with constructors, methods, inheritance, and super calls.',
		code: `(class Animal
  (ctor [name]
    (/name = name))
  (method speak []
    "..."))

(class Dog < Animal
  (method speak []
    ("Woof! I am " .append /name)))

(class LoudDog < Dog
  (method speak []
    ((super .speak) .append "!!!")))

(var dog (new LoudDog "Rex"))
(println dog/.speak)         # => Woof! I am Rex!!!
(println (dog is Animal))    # => true
(println (dog is Dog))       # => true

# Abstract methods enforce interface contracts
(class Shape
  (abstract method area []))
(try
  ((new Shape) .area)
catch _
  (println "abstract call caught:" $ex))`,
	},
	{
		title: 'Generators',
		description:
			'Lazy sequences with fn* and yield. Generators produce values on demand via for-in.',
		code: `# Generator function uses fn* and yield
(fn* range [start end]
  (var i start)
  (loop
    (if (i >= end) (break))
    (yield i)
    (i += 1)))

# Iterate lazily over generated values
(for i in (range 0 5)
  (print i " "))             # => 0 1 2 3 4
(println)

# Squares generator
(fn* squares [n]
  (var i 0)
  (loop
    (if (i >= n) (break))
    (yield (i * i))
    (i += 1)))

(for s in (squares 6)
  (print s " "))             # => 0 1 4 9 16 25
(println)

# Range literal syntax
(for i in (1 .. 5)
  (print i " "))             # => 1 2 3 4 5
(println)`,
	},
	{
		title: 'Pattern Matching',
		description:
			'case/when for value matching, if as an expression, and for-in with index destructuring.',
		code: `# case/when matches values
(fn describe [n]
  (case n
    when 0 "zero"
    when 1 "one"
    when 2 "two"
    else "many"))

(println (describe 0))       # => zero
(println (describe 2))       # => two
(println (describe 99))      # => many

# if is an expression — assign the result directly
(var score 85)
(var grade
  (if (score >= 90) "A"
   elif (score >= 80) "B"
   elif (score >= 70) "C"
   else "F"))
(println "Grade:" grade)     # => B

# for-in with index destructuring
(var fruits ["apple" "banana" "cherry"])
(for [i item] in fruits
  (println i ":" item))`,
	},
	{
		title: 'AOP Decorators',
		description:
			'Aspect-oriented programming with before/around/after advices and reusable aspect bundles.',
		code: `# Define a plain function
(fn compute [a b]
  (a + b))

# before advice runs before the function body
(before compute [a b]
  (println "→ computing" a "+" b))

# after advice receives the return value
(after compute [a b result]
  (println "← result:" result))

# Calling compute now fires all advices
(compute 3 4)
# → computing 3 + 4
# ← result: 7

(println (compute 10 20))
# → computing 10 + 20
# ← result: 30
# 30`,
	},
	{
		title: 'Enums & Error Handling',
		description:
			'Algebraic data types with enums, typed catch blocks, and the $ex special variable.',
		code: `# Algebraic data types
(enum Option
  (Some value)
  None)

(enum Result
  (Ok value)
  (Err error))

(var found (Option/Some 42))
(var missing Option/None)

(println found/tag found/values/0)   # => Some 42
(println missing/tag)                # => None

# Typed exception handling
(fn safe_div [a b]
  (try
    (if (b == 0)
      (throw "Division by zero"))
    (a / b)
  catch String
    (println "Caught:" $ex)
    nil))

(println (safe_div 10 2))    # => 5
(println (safe_div 10 0))    # => nil (caught "Division by zero")`,
	},
	{
		title: 'Async / Await',
		description:
			'First-class async/await with futures. Works in both native and WASM environments.',
		code: `# async wraps a value in a future
(var f (async 42))
(var result (await f))
(println "async result:" result)   # => 42

# Chained async computation
(fn async_add [a b]
  (async (a + b)))

(var sum (await (async_add 10 20)))
(println "async sum:" sum)         # => 30

# Async with computation
(fn compute_async [n]
  (async
    (var result 0)
    (for i in (1 .. n)
      (result += i))
    result))

(println "sum 1..10:" (await (compute_async 10)))  # => 55`,
	},
];
---

<Layout
	title="Gene Code Examples"
	description="Runnable Gene code examples. Click ▶ Run to evaluate any example live in your browser via WASM."
>
	<header class="page-header">
		<h1>Examples</h1>
		<p>
			Runnable Gene code snippets — click <strong>▶ Run</strong> on any example to evaluate it live in
			your browser via WASM. I/O operations (file access, threads) are capability-gated and will show
			an error in the browser, which is expected.
		</p>
	</header>

	<section class="example-grid">
		{examples.map((example) => (
			<article class="example-card">
				<h2>{example.title}</h2>
				<p>{example.description}</p>
				<CodeRunner code={example.code} />
			</article>
		))}
	</section>

	<section class="note">
		<strong>Browser Playground</strong>
		<span>
			All examples run client-side via the Gene WASM build — no server required. Operations that
			require native capabilities (threads, file I/O, channels) will show an error in the browser,
			which is intentional: the capability sandbox is working correctly.
		</span>
	</section>
</Layout>

<style>
	.page-header {
		display: grid;
		gap: 0.75rem;
		margin-bottom: 3rem;
	}

	.page-header h1 {
		margin: 0;
		font-size: clamp(2.1rem, 3vw, 2.7rem);
	}

	.page-header p {
		color: var(--color-muted);
		max-width: 50rem;
		margin: 0;
	}

	.example-grid {
		display: grid;
		gap: 2.5rem;
	}

	.example-card {
		background: var(--color-surface);
		border-radius: 1.1rem;
		border: 1px solid var(--color-border);
		padding: 1.75rem;
		box-shadow: 0 18px 32px rgba(15, 23, 42, 0.12);
		display: grid;
		gap: 0.75rem;
	}

	.example-card h2 {
		margin: 0;
		font-size: 1.45rem;
	}

	.example-card p {
		margin: 0;
		color: var(--color-muted);
	}

	.note {
		margin-top: 3rem;
		display: grid;
		gap: 0.4rem;
		background: var(--color-surface);
		border: 1px solid var(--color-border);
		border-radius: 1rem;
		padding: 1.2rem 1.5rem;
		color: var(--color-muted);
	}

	.note strong {
		color: var(--color-text);
	}
</style>
